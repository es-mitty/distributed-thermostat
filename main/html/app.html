<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermostat</title>
</head>

<body>
</body>
<script>
    body = document.body;

    test_json = {
        "system_name": "388 College St. #6",
        "zones": [
            {
                "name": "Eli's Room",
                "target_temp": 10.0,
                "measured_temp": 9.8,
            },
            {
                "name": "Luke's Room",
                "target_temp": 11.0,
                "measured_temp": 10.8,
            },
            {
                "name": "Living Room",
                "target_temp": 12.0,
                "measured_temp": 11.8,
            },
        ]
    };

    document.title = test_json.system_name;
    heading = document.createElement("h1");
    heading.innerHTML = test_json.system_name;
    body.appendChild(heading)

    function changeItem(key, index, value) {
        test_json.zones[index][key] = value;
        console.log(test_json);
    }

    function gen_input_elem(element, key, index, label) {
        return `<label for="${key}">${label}</label><input type="text" name="${key}" value="${element[key]}" onchange="changeItem(${key}, ${index}, this.value)"><br>`
    }

    function refresh_ui() {
        test_json.zones.forEach((element, index, array) => {
            elem = document.createElement("section");
            elem.innerHTML += gen_input_elem(element, "name", index, "Name");
            elem.innerHTML += gen_input_elem(element, "target_temp", index, "Desired Temp");
            elem.innerHTML += `Measured Temp: ${element.measured_temp}`
            body.appendChild(elem);
        });
    }
    refresh_ui();

    async function getData() {
        response = await fetch("thermostat.local/data");
        json = await response.json();
        if(json)
            test_json = JSON.stringify(json);
    };
    setTimeout(getData, 1000);
</script>

</html>